---
layout: post
title: Menhir を用いた，エラーハンドリングを適切に行うパーサの実装
excerpt: >
  OCaml のパーサジェネレータ Menhir には，
  エラーハンドリングを宣言的に記述する仕組みがありますが，
  その分かりやすい解説は私の知る限りでは存在しません．
  本稿では Menhir プロジェクト内に用意されたデモを動かしながら，
  その使い方を解説します．
categories: [Programming Language]
author: sano
---

> OCaml のパーサジェネレータ Menhir には，
> エラーハンドリングを宣言的に記述する仕組みがありますが，
> その分かりやすい解説は私の知る限りでは存在しません．
> 本稿では Menhir プロジェクト内に用意されたデモを動かしながら，
> その使い方を解説します．

この美しい世界には，
OCaml という素晴らしいプログラミング言語が存在します．
この言語は非常に多目的であり，
例えば言語処理系（コンパイラやインタプリタ）を構築することも可能です．
実際，OCaml のコンパイラは OCaml 自身で実装されています．

言語処理系は，ソースコードを読み取り，
機械語などの形式に変換するために，
まずソースコードをトークンの列へ変換する「字句解析」を行い，
次にトークンの列を抽象構文木という木構造へ変換する「構文解析」を行います．

特に，構文解析の実装は，ゼロから自力で行うと非常に骨の折れる作業となります．
そのため，一般的にはパーサジェネレータなどのツールを使用します．
OCaml では，Menhir という優れたパーサジェネレータが利用可能です．
このツールを活用することで，構文解析の実装を手軽に行うことができます．

Menhir には優れたエラーハンドリングの仕組みがあり，
ユーザが構文的な間違いを含むコードを書いた際に適切なエラーメッセージを出力する機能を，
最小限の手間で実装できます．
ただし，この機能は公式ドキュメント内では言及されており，
また Menhir の gitlab リポジトリ内にデモとして用意されてはいるものの，
分かりやすい解説などは私の知る限りでは提供されていません．

そこで本稿では Menhir を用いて，
エラーハンドリングを含むパーサを生成する方法について，
私が模索した結果を共有し，解説したいと思います．

## サンプルコード及びその動かし方

本稿では Menhir の gitlab リポジトリ内のデモとして提供されている
[calc-syntax-errors](https://gitlab.inria.fr/fpottier/menhir/-/tree/master/demos/calc-syntax-errors)
を用いて解説します．
このコードは
[INRIA が提供している Menhir の公式リポジトリ](https://gitlab.inria.fr/fpottier/menhir/)
の `/demo/calc-syntax-errors` ディレクトリ内に存在します．
ただし，Menhir 全体はそれなりにサイズの大きいプロジェクトであるため，
取り回しの容易さのために，今回使用するコードを別途別のリポジトリに用意しました．
これらのコードは私が実装したものではなく，
Menhir 開発チームの功績によるものだということを，
断っておきます．
